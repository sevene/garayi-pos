"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2461],{2144:(e,t,r)=>{r.d(t,{w:()=>s});function s(e){let t=(e.products||[]).reduce((e,t)=>e+t.quantity*t.unitCost,0),r=e.laborCost;"percentage"===e.laborCostType&&(r=e.servicePrice*e.laborCost/100);let s=t+r,a=e.servicePrice-s,l=e.servicePrice>0?(a/e.servicePrice*100).toFixed(2)+"%":"0%";return{materialCost:t,laborCost:r,totalCost:s,profitMargin:a,profitPercentage:l}}},2461:(e,t,r)=>{r.d(t,{A:()=>g});var s=r(5155),a=r(2115),l=r(63),i=r(7218),n=r(3569),o=r(2144),c=r(367),d=r(6473),u=r(1962),m=r(460),x=r(3328),p=r(370),b=r(9749);let h=e=>{let{products:t,availableProducts:r,onAdd:a,onRemove:l,onUpdate:o,title:d="Product Recipe"}=e,{formatCurrency:m}=(0,b.t)();return(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center border-b border-gray-300 pb-2",children:[(0,s.jsx)("h3",{className:"text-lg font-semibold text-gray-800",children:d}),(0,s.jsxs)("button",{type:"button",onClick:a,className:"text-sm px-3 py-1.5 bg-lime-50 text-lime-600 rounded-lg hover:bg-lime-100 transition flex items-center gap-1 font-medium",children:[(0,s.jsx)(i.A,{className:"w-4 h-4"}),"Add Product"]})]}),t&&t.length>0?(0,s.jsx)("div",{className:"space-y-3",children:t.map((e,t)=>(0,s.jsxs)("div",{className:"flex gap-3 items-start p-4 bg-gray-50 rounded-xl border border-gray-100",children:[(0,s.jsx)("div",{className:"flex-4 min-w-20",children:(0,s.jsx)(c.A,{label:"Product",value:e.productId,onChange:e=>o(t,"productId",e),options:r.map(e=>({label:"".concat(e.name," (").concat(m(Number(e.price)),")"),value:e._id})),placeholder:"Select product..."})}),(0,s.jsx)("div",{className:"flex-2 min-w-16",children:(0,s.jsx)(c.A,{label:"Sold By",value:e.soldBy||"quantity",onChange:e=>o(t,"soldBy",e),options:[{label:"Quantity",value:"quantity"},{label:"Volume/Weight",value:"volume"}]})}),(0,s.jsxs)("div",{className:"flex flex-col flex-1 min-w-10",children:[(0,s.jsx)("label",{className:"block text-xs font-medium text-gray-700 mb-1.5",children:"Quantity"}),(0,s.jsx)("input",{type:"number",value:""===e.quantity?"":Number(e.quantity).toString(),onChange:e=>o(t,"quantity",(0,u.i)(e.target.value)),min:"0.01",step:"0.01",className:"w-full border border-gray-200 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-lime-500/20 focus:border-lime-500 outline-none bg-white"})]}),(0,s.jsxs)("div",{className:"flex flex-col flex-1 min-w-10",children:[(0,s.jsx)("label",{className:"block text-xs font-medium text-gray-700 mb-1.5 text-center",children:"Cost"}),(0,s.jsx)("div",{className:"h-[38px] px-3 py-2 text-sm text-gray-700 flex items-center justify-center",children:m(Number(e.quantity)*e.unitCost)})]}),(0,s.jsx)("div",{className:"flex items-center self-center",children:(0,s.jsx)("button",{type:"button",onClick:()=>l(t),className:"p-2 text-red-600 hover:bg-red-100 rounded-lg transition",title:"Remove product",children:(0,s.jsx)(n.A,{className:"w-5 h-5"})})})]},t))}):(0,s.jsxs)("div",{className:"text-center py-8 bg-gray-50 rounded-xl border border-dashed border-gray-300",children:[(0,s.jsx)("p",{className:"text-gray-500",children:"No products added to this recipe."}),(0,s.jsx)("button",{type:"button",onClick:a,className:"text-green-600 hover:underline mt-1 text-sm",children:"Add a product"})]})]})},v={_id:"",name:"",description:"",category:null,products:[],servicePrice:"",laborCost:"",laborCostType:"fixed",durationMinutes:"",active:!0,variants:[]};function g(e){var t,r,g,f;let{initialData:y,isEditing:N=!1}=e,{formatCurrency:j,settings:C}=(0,b.t)(),w=(null==C?void 0:C.currency)==="USD"?"$":(null==C?void 0:C.currency)==="EUR"?"€":"₱",P=(0,l.useRouter)(),[k,S]=(0,a.useState)(y?{...y,servicePrice:y.servicePrice,laborCost:y.laborCost,laborCostType:y.laborCostType||"fixed",durationMinutes:null!=(r=y.durationMinutes)?r:"",products:y.products.map(e=>({...e,quantity:e.quantity})),variants:(null==(t=y.variants)?void 0:t.map(e=>{var t;return{...e,price:e.price,products:(null==(t=e.products)?void 0:t.map(e=>({...e,quantity:e.quantity})))||[]}}))||[]}:v),[q,A]=(0,a.useState)([]),[M,T]=(0,a.useState)([]),[I,E]=(0,a.useState)(!1),[_,B]=(0,a.useState)(null),R=(0,p.Y)();(0,a.useEffect)(()=>{if(y){var e,t;S({...y,servicePrice:y.servicePrice,laborCost:y.laborCost,laborCostType:y.laborCostType||"fixed",durationMinutes:null!=(t=y.durationMinutes)?t:"",products:y.products.map(e=>({...e,quantity:e.quantity})),variants:(null==(e=y.variants)?void 0:e.map(e=>{var t;return{...e,price:e.price,products:(null==(t=e.products)?void 0:t.map(e=>({...e,quantity:e.quantity})))||[]}}))||[]})}},[y]),(0,a.useEffect)(()=>{(async()=>{try{let e="/api";if(!e)return;let t=await fetch("".concat(e,"/products"));if(t.ok){let e=await t.json();A(e)}let r=await fetch("".concat(e,"/categories"));if(r.ok){let e=await r.json();T(e)}}catch(e){console.error("Failed to fetch dependencies",e)}})()},[N]);let L=e=>{let{name:t,value:r,type:s}=e.target,a="number"===s?(0,u.i)(r):r;S(e=>({...e,[t]:a}))},F=()=>{S(e=>{let t=0===e.variants.length&&e.products.length>0?[...e.products]:[],r=0===e.variants.length&&e.products.length>0?[]:e.products;return{...e,products:r,variants:[...e.variants||[],{name:"",price:0,products:t}]}})},U=(e,t,r)=>{S(s=>{let a=[...s.variants||[]];return a[e]={...a[e],[t]:r},{...s,variants:a}})},V=async e=>{if(e.preventDefault(),!I){E(!0),B(null);try{var t;let e="/api";if(!e)throw Error("API URL not configured");let r=N?"".concat(e,"/services/").concat(k._id):"".concat(e,"/services"),{_id:s,createdAt:a,updatedAt:l,...i}=k,n={...i,servicePrice:""===i.servicePrice?0:Number(i.servicePrice),laborCost:""===i.laborCost?0:Number(i.laborCost),laborCostType:i.laborCostType,durationMinutes:""===i.durationMinutes?0:Number(i.durationMinutes),products:i.products.map(e=>({...e,quantity:Number(e.quantity)})),variants:(null==(t=i.variants)?void 0:t.map(e=>{var t;return{name:e.name,price:Number(e.price),products:(null==(t=e.products)?void 0:t.map(e=>({...e,quantity:Number(e.quantity)})))||[]}}))||[]};if("__v"in n&&delete n.__v,console.log("Submitting Service Payload:",n),!(await fetch(r,{method:N?"PUT":"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)})).ok)throw Error("Failed to save");P.push("/admin/services"),P.refresh()}catch(e){console.error(e),B("Failed to save service. Please try again."),E(!1)}}},D={...k,servicePrice:Number(k.servicePrice),laborCost:Number(k.laborCost),laborCostType:k.laborCostType,durationMinutes:""===k.durationMinutes?0:Number(k.durationMinutes),products:k.products.map(e=>({...e,quantity:Number(e.quantity)}))},O=(0,o.w)(D),W=k.variants&&k.variants.length>0;return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(x.A,{title:N?"Edit Service":"Create New Service",isScrolled:R,formId:"service-form",saveLabel:N?"Update Service":"Create Service",isSaving:I}),(0,s.jsxs)("div",{className:"flex flex-col lg:flex-row gap-8 items-start relative",children:[(0,s.jsx)("div",{className:"flex-1 min-w-0",children:(0,s.jsx)("div",{className:"bg-white rounded-xl shadow-md border border-white",children:(0,s.jsxs)("form",{id:"service-form",onSubmit:V,className:"p-6 space-y-6",children:[_&&(0,s.jsx)("div",{className:"p-4 bg-red-50 text-red-700 rounded-lg border border-red-200",children:_}),(0,s.jsx)("div",{className:"space-y-4",children:(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,s.jsx)("div",{className:"md:col-span-2",children:(0,s.jsx)("div",{className:"relative z-0 w-full group",children:(0,s.jsx)(d.A,{label:"Service Name",name:"name",id:"name",value:k.name,onChange:L,required:!0})})}),(0,s.jsx)("div",{children:(0,s.jsx)(c.A,{label:"Category",value:k.category,onChange:e=>S(t=>({...t,category:String(e)})),options:(0,m.F)(M).map(e=>({label:e.label,value:e.value})),placeholder:"Select a category..."})}),(0,s.jsx)("div",{children:(0,s.jsx)(d.A,{label:"Duration (minutes)",type:"number",name:"durationMinutes",value:""===k.durationMinutes?"":Number(k.durationMinutes).toString(),onChange:L,min:"0",placeholder:"e.g. 60"})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Visibility"}),(0,s.jsxs)("div",{className:"flex items-center gap-3 h-[38px]",children:[(0,s.jsx)("button",{type:"button",onClick:()=>S(e=>{var t;return{...e,showInPos:!(null==(t=e.showInPos)||t)}}),className:"relative inline-flex h-6 w-11 items-center rounded-full transition-colors focus:outline-none focus:ring-2 focus:ring-lime-500 focus:ring-offset-2 ".concat(null==(g=k.showInPos)||g?"bg-lime-500":"bg-gray-200"),children:(0,s.jsx)("span",{className:"inline-block h-4 w-4 transform rounded-full bg-white transition-transform ".concat(null==(f=k.showInPos)||f?"translate-x-6":"translate-x-1")})}),(0,s.jsx)("span",{className:"text-sm text-gray-700",children:"Show in POS"})]})]}),(0,s.jsx)("div",{className:"md:col-span-2",children:(0,s.jsx)(d.A,{label:"Description",name:"description",value:k.description||"",onChange:L,multiline:!0,rows:3,placeholder:"Describe the service..."})})]})}),(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsx)("h3",{className:"text-lg font-semibold text-gray-800 border-b border-gray-300 pb-2",children:"Pricing & Costs"}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,s.jsx)("div",{children:(0,s.jsx)(d.A,{label:"Service Price (".concat(w,") *"),type:"number",name:"servicePrice",value:""===k.servicePrice?"":Number(k.servicePrice).toString(),onChange:L,min:"0",step:"0.01",disabled:W})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Labor Cost *"}),(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)("div",{className:"w-1/2",children:(0,s.jsx)(c.A,{value:k.laborCostType,onChange:e=>S(t=>({...t,laborCostType:e})),options:[{label:"Fixed (".concat(w,")"),value:"fixed"},{label:"Percentage (%)",value:"percentage"}]})}),(0,s.jsx)("div",{className:"flex-1",children:(0,s.jsx)(d.A,{type:"number",name:"laborCost",value:""===k.laborCost?"":Number(k.laborCost).toString(),onChange:L,min:"0",step:"0.01",placeholder:"percentage"===k.laborCostType?"e.g. 10":"e.g. 150.00"})})]})]})]})]}),!W&&(0,s.jsx)(h,{title:"Product Recipe",products:k.products,availableProducts:q,onAdd:()=>{k.products||S(e=>({...e,products:[]})),S(e=>({...e,products:[...e.products||[],{productId:"",quantity:"",productName:"",unitCost:0,soldBy:"quantity"}]}))},onRemove:e=>{S(t=>({...t,products:t.products.filter((t,r)=>r!==e)}))},onUpdate:(e,t,r)=>{S(s=>{let a=[...s.products],l=a[e];if("productId"===t){let t=q.find(e=>e._id===r);if(t){let s="volume"===l.soldBy?Number(t.cost||0):Number(t.price||0);a[e]={...l,productId:r,productName:t.name,unitCost:s}}}else if("soldBy"===t){let t=q.find(e=>e._id===l.productId),s=l.unitCost;t&&(s="volume"===r?Number(t.cost||0):Number(t.price||0)),a[e]={...l,soldBy:r,unitCost:s}}else a[e]={...l,[t]:r};return{...s,products:a}})}}),(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center border-b border-gray-200 pb-2",children:[(0,s.jsx)("h3",{className:"text-lg font-semibold text-gray-800",children:"Service Variants"}),(0,s.jsxs)("button",{type:"button",onClick:F,className:"text-sm px-3 py-1.5 bg-lime-50 text-lime-600 rounded-lg hover:bg-lime-100 transition flex items-center gap-1 font-medium",children:[(0,s.jsx)(i.A,{className:"w-4 h-4"}),"Add Variant"]})]}),W?(0,s.jsx)("div",{className:"space-y-4",children:k.variants.map((e,t)=>(0,s.jsxs)("div",{className:"p-4 bg-gray-50 rounded-xl border border-gray-100 space-y-4",children:[(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsxs)("div",{className:"flex-1 grid grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Variant Name"}),(0,s.jsx)("input",{type:"text",value:e.name,onChange:e=>U(t,"name",e.target.value),placeholder:"e.g. Long Hair",className:"w-full border border-gray-200 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-lime-500/20 focus:border-lime-500 outline-none transition"})]}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:["Price (",w,")"]}),(0,s.jsx)("input",{type:"number",value:""===e.price?"":Number(e.price).toString(),onChange:e=>U(t,"price",(0,u.i)(e.target.value)),min:"0",step:"0.01",placeholder:"0.00",className:"w-full border border-gray-200 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-lime-500/20 focus:border-lime-500 outline-none transition"})]})]}),(0,s.jsx)("div",{className:"flex items-baseline-last",children:(0,s.jsx)("button",{type:"button",onClick:()=>{S(e=>({...e,variants:(e.variants||[]).filter((e,r)=>r!==t)}))},className:"ml-4 p-2 text-red-600 hover:bg-red-100 rounded-lg transition",title:"Remove variant",children:(0,s.jsx)(n.A,{className:"w-5 h-5"})})})]}),(0,s.jsx)("div",{children:(0,s.jsx)(h,{title:"Recipe for ".concat(e.name||"Variant"),products:e.products,availableProducts:q,onAdd:()=>{S(e=>{let r=[...e.variants],s=r[t];return r[t]={...s,products:[...s.products||[],{productId:"",quantity:"",productName:"",unitCost:0,soldBy:"quantity"}]},{...e,variants:r}})},onRemove:e=>{S(r=>{let s=[...r.variants],a=s[t];return s[t]={...a,products:a.products.filter((t,r)=>r!==e)},{...r,variants:s}})},onUpdate:(e,r,s)=>{S(a=>{let l=[...a.variants],i=l[t],n=[...i.products],o=n[e];if("productId"===r){let t=q.find(e=>e._id===s);if(t){let r="volume"===o.soldBy?Number(t.cost||0):Number(t.price||0);n[e]={...o,productId:s,productName:t.name,unitCost:r}}}else if("soldBy"===r){let t=q.find(e=>e._id===o.productId),r=o.unitCost;t&&(r="volume"===s?Number(t.cost||0):Number(t.price||0)),n[e]={...o,soldBy:s,unitCost:r}}else n[e]={...o,[r]:s};return l[t]={...i,products:n},{...a,variants:l}})}})})]},t))}):(0,s.jsxs)("div",{className:"text-center py-8 bg-gray-50 rounded-xl border border-dashed border-gray-300",children:[(0,s.jsx)("p",{className:"text-gray-500",children:"No variants added."}),(0,s.jsx)("button",{type:"button",onClick:F,className:"text-green-600 hover:underline mt-1 text-sm",children:"Add a variant"})]})]})]})})}),(0,s.jsx)("div",{className:"w-full lg:w-[40%] sticky top-16",children:(0,s.jsxs)("div",{className:"bg-blue-50 p-5 rounded-xl w-full shadow-md",children:[(0,s.jsx)("h3",{className:"font-semibold text-blue-900 mb-5 pb-4 border-b border-blue-200",children:"Estimated Cost & Profit"}),(0,s.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[(0,s.jsxs)("div",{className:"flex flex-col items-center justify-center text-center",children:[(0,s.jsx)("span",{className:"block text-blue-600 mb-1",children:"Materials Cost"}),(0,s.jsx)("span",{className:"text-lg font-semibold text-blue-900",children:W?"--":j(O.materialCost)})]}),(0,s.jsxs)("div",{className:"flex flex-col items-center justify-center text-center",children:[(0,s.jsx)("span",{className:"block text-blue-600 mb-1",children:"Labor Cost"}),(0,s.jsx)("span",{className:"text-lg font-semibold text-blue-900",children:"percentage"===k.laborCostType?"".concat(Number(k.laborCost),"%"):j(O.laborCost)})]}),(0,s.jsxs)("div",{className:"flex flex-col items-center justify-center text-center",children:[(0,s.jsx)("span",{className:"block text-blue-600 mb-1",children:"Total Cost"}),(0,s.jsx)("span",{className:"text-lg font-bold ".concat(W?"text-gray-400":"text-blue-900"),children:W?"--":j(O.totalCost)})]}),(0,s.jsxs)("div",{className:"flex flex-col items-center justify-center text-center",children:[(0,s.jsx)("span",{className:"block text-blue-600 mb-1",children:"Base Net Profit"}),W?(0,s.jsx)("span",{className:"text-lg font-medium text-gray-400",children:"--"}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("span",{className:"text-lg font-medium ".concat(O.profitMargin>=0?"text-green-600":"text-red-600"),children:j(O.profitMargin)}),(0,s.jsxs)("span",{className:"text-xs ml-1 ".concat(O.profitMargin>=0?"text-green-600":"text-red-600"),children:["(",O.profitPercentage,")"]})]})]})]}),W&&(0,s.jsxs)("div",{className:"pt-4 mt-4",children:[(0,s.jsx)("h4",{className:"text-sm font-semibold text-blue-900 mb-3",children:"Variant Profitability"}),(0,s.jsx)("div",{className:"overflow-x-auto rounded-lg border border-blue-100",children:(0,s.jsxs)("table",{className:"w-full text-sm text-left",children:[(0,s.jsx)("thead",{className:"bg-white border-b border-blue-100 text-blue-900 font-semibold",children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{className:"px-4 py-3 text-center",children:"Variant Name"}),(0,s.jsx)("th",{className:"px-4 py-3 text-center",children:"Price"}),(0,s.jsx)("th",{className:"px-4 py-3 text-center",children:"Prime Cost"}),(0,s.jsx)("th",{className:"px-4 py-3 text-center",children:"Net Profit"}),(0,s.jsx)("th",{className:"px-4 py-3 text-center",children:"Margin"})]})}),(0,s.jsx)("tbody",{className:"divide-y divide-blue-50 bg-white",children:k.variants.map((e,t)=>{let r=Number(e.price)||0,a=e.products.reduce((e,t)=>e+Number(t.quantity)*t.unitCost,0),l=Number(k.laborCost)||0;"percentage"===k.laborCostType&&(l=r*l/100);let i=a+l,n=r-i,o=r>0?(n/r*100).toFixed(2)+"%":"0%";return(0,s.jsxs)("tr",{className:"hover:bg-blue-50/50 transition-colors",children:[(0,s.jsx)("td",{className:"px-4 py-3 font-medium text-blue-900 text-center",children:e.name||"Untitled"}),(0,s.jsx)("td",{className:"px-4 py-3 text-blue-900 text-center",children:j(r)}),(0,s.jsx)("td",{className:"px-4 py-3 text-blue-900 text-center",children:(0,s.jsxs)("div",{className:"flex flex-col items-center",children:[(0,s.jsx)("span",{children:j(i)}),(0,s.jsxs)("span",{className:"text-xs text-gray-500",children:["(Mat: ",j(a)," + Lab: ",j(l),")"]})]})}),(0,s.jsx)("td",{className:"px-4 py-3 text-center ".concat(n>=0?"text-green-600":"text-red-600"),children:j(n)}),(0,s.jsx)("td",{className:"px-4 py-3 text-center ".concat(n>=0?"text-green-600":"text-red-600"),children:o})]},t)})})]})})]})]})})]})]})}},3569:(e,t,r)=>{r.d(t,{A:()=>a});var s=r(2115);let a=s.forwardRef(function(e,t){let{title:r,titleId:a,...l}=e;return s.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":a},l),r?s.createElement("title",{id:a},r):null,s.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18 18 6M6 6l12 12"}))})},7218:(e,t,r)=>{r.d(t,{A:()=>a});var s=r(2115);let a=s.forwardRef(function(e,t){let{title:r,titleId:a,...l}=e;return s.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":a},l),r?s.createElement("title",{id:a},r):null,s.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4.5v15m7.5-7.5h-15"}))})}}]);