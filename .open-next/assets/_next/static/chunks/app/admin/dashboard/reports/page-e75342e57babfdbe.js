(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4153],{2507:(e,t,r)=>{"use strict";r.d(t,{A:()=>a});var s=r(5155);function a(e){let{title:t,description:r,className:a=""}=e;return(0,s.jsxs)("div",{className:"relative ".concat(a),children:[(0,s.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:t}),r&&(0,s.jsx)("p",{className:"text-base font-normal text-gray-700 mt-2 tracking-wide",children:r})]})}r(2115)},2716:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>v});var s=r(5155),a=r(2115),l=r(2507),n=r(7164),i=r(707),c=r(194),d=r(5350),o=r(9749),x=r(4932),y=r(8674),m=r(8901),p=r(3366),h=r(6467),u=r(6429),g=r(661),f=r(7717),b=r(3317),N=r(9152),j=r(6753);function v(){let{formatCurrency:e}=(0,o.t)(),t="/api",[r,v]=(0,a.useState)("SALES"),[S,M]=(0,a.useState)({start:(0,x.GP)((0,y.w)(new Date),"yyyy-MM-dd"),end:(0,x.GP)((0,m.p)(new Date),"yyyy-MM-dd")}),[k,C]=(0,a.useState)([]),[E,P]=(0,a.useState)([]),[A,_]=(0,a.useState)([]),[R,G]=(0,a.useState)([]),[D,H]=(0,a.useState)(!0);(0,a.useEffect)(()=>{(async()=>{if(t){H(!0);try{let[e,r,s,a]=await Promise.all([fetch("".concat(t,"/tickets?all=true")),fetch("".concat(t,"/employees")),fetch("".concat(t,"/services")),fetch("".concat(t,"/products?all=true"))]);e.ok&&C(await e.json()),r.ok&&P(await r.json()),s.ok&&_(await s.json()),a.ok&&G(await a.json())}catch(e){console.error("Error fetching report data:",e)}finally{H(!1)}}})()},[t]);let I=(0,a.useMemo)(()=>{let e={start:(0,p.o)((0,h.H)(S.start)),end:(0,u.D)((0,h.H)(S.end))},t=k.filter(t=>{if("COMPLETED"!==t.status)return!1;let r=(0,h.H)(t.createdAt);return(0,g.v)(r,e)}),r={},s={};E.forEach(e=>{s[e._id]={name:e.name,tickets:0,sales:0,commission:0}});let a={};t.forEach(e=>{let t=(0,x.GP)((0,h.H)(e.createdAt),"yyyy-MM-dd"),l=Number(e.total)||0;if(r[t]||(r[t]={date:t,revenue:0,count:0,customers:new Set}),r[t].revenue+=l,r[t].count+=1,e.customer){let s="object"==typeof e.customer?e.customer._id:e.customer;s&&r[t].customers.add(s)}let n=Array.isArray(e.crew)?e.crew:[],i=n.length,c=i>0?l/i:0;n.forEach(e=>{let t="object"==typeof e&&e._id?e._id:"string"==typeof e?e:null;t&&(s[t]||(s[t]={name:e.name||"Unknown",tickets:0,sales:0,commission:0}),s[t].tickets+=1,s[t].sales+=c)}),e.items.forEach(e=>{let t=Number(e.quantity)||0,r=Number(e.unitPrice)||0,l=t*r,c=Number(e.unitCost)||0,d=Number(e.commission)||0;if(0===c&&0===d){let t=A.find(t=>t._id===e.productId||t.name===e.productName||e.productName.startsWith(t.name));if(t)d="percentage"===t.laborCostType?r*(Number(t.laborCost)||0)/100:Number(t.laborCost)||0;else{let t=R.find(t=>t._id===e.productId||t.name===e.productName);t&&(c=Number(t.cost)||0)}}let o=(c+d)*t,x=e.productId||e.productName;if(!a[x]){let t=d>0||A.some(t=>t._id===e.productId);a[x]={name:e.productName,type:t?"Service":"Product",qty:0,revenue:0,cost:0,profit:0}}if(a[x].qty+=t,a[x].revenue+=l,a[x].cost+=o,a[x].profit+=l-o,i>0&&d>0){let e=d*t/i;n.forEach(t=>{let r="object"==typeof t&&t._id?t._id:"string"==typeof t?t:null;r&&s[r]&&(s[r].commission+=e)})}})});let l=Object.values(r).sort((e,t)=>t.date.localeCompare(e.date)),n=Object.values(s).filter(e=>e.tickets>0||e.sales>0).sort((e,t)=>t.sales-e.sales),i=Object.values(a).sort((e,t)=>t.revenue-e.revenue),c=t.reduce((e,t)=>e+(Number(t.total)||0),0),d=i.reduce((e,t)=>e+t.profit,0);return{filteredTickets:t,salesArray:l,crewArray:n,itemArray:i,totalRevenue:c,totalProfit:d}},[k,E,A,R,S]);return(0,s.jsxs)("div",{className:"relative h-full w-full overflow-hidden text-gray-800 animate-in fade-in duration-700 lg:px-6 lg:pb-6",children:[(0,s.jsxs)("div",{className:"flex flex-col xl:flex-row justify-between items-start xl:items-end gap-6 mb-8",children:[(0,s.jsx)(l.A,{title:"Reports Center",description:"Detailed analysis of sales, detailed staff performance, and product margins."}),(0,s.jsxs)("div",{className:"flex flex-col md:flex-row items-end gap-4 bg-white p-2 rounded-2xl shadow-sm border border-gray-100 w-full xl:w-auto",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 bg-gray-50 p-1.5 rounded-xl w-full md:w-auto",children:[(0,s.jsx)("input",{type:"date",id:"start-date",className:"bg-transparent border-none text-sm font-bold text-gray-700 focus:ring-0 p-2",value:S.start,onChange:e=>M(t=>({...t,start:e.target.value}))}),(0,s.jsx)("span",{className:"text-gray-400",children:"-"}),(0,s.jsx)("input",{type:"date",id:"end-date",className:"bg-transparent border-none text-sm font-bold text-gray-700 focus:ring-0 p-2",value:S.end,onChange:e=>M(t=>({...t,end:e.target.value}))})]}),(0,s.jsx)("div",{className:"flex gap-1 bg-gray-50 p-1.5 rounded-xl",children:["today","week","month","year"].map(e=>(0,s.jsx)("button",{onClick:()=>(e=>{let t=new Date;if("today"===e){let e=(0,x.GP)(t,"yyyy-MM-dd");M({start:e,end:e})}else"week"===e?M({start:(0,x.GP)((0,f.e)(t,7),"yyyy-MM-dd"),end:(0,x.GP)(t,"yyyy-MM-dd")}):"month"===e?M({start:(0,x.GP)((0,y.w)(t),"yyyy-MM-dd"),end:(0,x.GP)((0,m.p)(t),"yyyy-MM-dd")}):"year"===e&&M({start:(0,x.GP)((0,b.D)(t),"yyyy-MM-dd"),end:(0,x.GP)((0,N.Q)(t),"yyyy-MM-dd")})})(e),className:"px-3 py-2 text-xs font-bold uppercase tracking-wider text-gray-500 hover:bg-white hover:shadow-sm rounded-lg transition-all",children:e},e))}),(0,s.jsx)("button",{onClick:()=>window.print(),className:"p-3 text-gray-500 hover:text-gray-900 bg-gray-50 hover:bg-lime-50 rounded-xl transition-colors",children:(0,s.jsx)(n.A,{className:"w-5 h-5"})})]})]}),(0,s.jsxs)("div",{className:"flex mb-6 overflow-x-auto pb-2 gap-2",children:[(0,s.jsx)(w,{active:"SALES"===r,onClick:()=>v("SALES"),icon:i.A,label:"Sales Summary"}),(0,s.jsx)(w,{active:"CREW"===r,onClick:()=>v("CREW"),icon:c.A,label:"Crew Performance"}),(0,s.jsx)(w,{active:"ITEMS"===r,onClick:()=>v("ITEMS"),icon:d.A,label:"Products & Services"})]}),(0,s.jsxs)("div",{className:"bg-gray-50 rounded-3xl shadow-sm border border-white overflow-hidden min-h-[500px]",children:[(0,s.jsxs)("div",{className:"bg-gray-50 border-b border-gray-200 p-6 flex justify-between items-center",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"text-lg font-bold text-gray-900",children:"SALES"===r?"Sales Report":"CREW"===r?"Staff Commission Report":"Item Profitability Report"}),(0,s.jsxs)("p",{className:"text-sm text-gray-500",children:[(0,j.f)((0,h.H)(S.start))?(0,x.GP)((0,h.H)(S.start),"MMM dd, yyyy"):"Invalid Date"," - ",(0,j.f)((0,h.H)(S.end))?(0,x.GP)((0,h.H)(S.end),"MMM dd, yyyy"):"Invalid Date"]})]}),(0,s.jsxs)("div",{className:"text-right",children:[(0,s.jsx)("p",{className:"text-xs font-bold text-gray-500 uppercase tracking-widest",children:"Total Revenue"}),(0,s.jsx)("p",{className:"text-2xl font-black text-gray-900",children:e(I.totalRevenue)})]})]}),(0,s.jsx)("div",{className:"overflow-x-auto",children:D?(0,s.jsx)("div",{className:"p-20 text-center text-gray-400",children:"Loading Report Data..."}):(0,s.jsxs)("table",{className:"w-full text-left text-sm whitespace-nowrap",children:["SALES"===r&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("thead",{className:"bg-gray-50 text-gray-500 font-bold text-xs uppercase tracking-wider border-b border-gray-100",children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{className:"px-8 py-5",children:"Date"}),(0,s.jsx)("th",{className:"px-8 py-5 text-center",children:"Orders"}),(0,s.jsx)("th",{className:"px-8 py-5 text-center",children:"Customers"}),(0,s.jsx)("th",{className:"px-8 py-5 text-right",children:"Avg. Ticket"}),(0,s.jsx)("th",{className:"px-8 py-5 text-right",children:"Revenue"})]})}),(0,s.jsxs)("tbody",{className:"divide-y divide-gray-50",children:[I.salesArray.map(t=>(0,s.jsxs)("tr",{className:"hover:bg-gray-50 transition-colors",children:[(0,s.jsx)("td",{className:"px-8 py-4 font-bold text-gray-800",children:(0,x.GP)((0,h.H)(t.date),"MMM dd, yyyy")}),(0,s.jsx)("td",{className:"px-8 py-4 text-center text-gray-600",children:t.count}),(0,s.jsx)("td",{className:"px-8 py-4 text-center text-gray-600",children:t.customers.size}),(0,s.jsx)("td",{className:"px-8 py-4 text-right text-gray-600",children:e(t.revenue/t.count)}),(0,s.jsx)("td",{className:"px-8 py-4 text-right font-bold text-lime-700",children:e(t.revenue)})]},t.date)),0===I.salesArray.length&&(0,s.jsx)("tr",{children:(0,s.jsx)("td",{colSpan:5,className:"px-8 py-10 text-center text-gray-400",children:"No sales in this period"})})]})]}),"CREW"===r&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("thead",{className:"bg-gray-50 text-gray-500 font-bold text-xs uppercase tracking-wider border-b border-gray-100",children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{className:"px-8 py-5",children:"Staff Member"}),(0,s.jsx)("th",{className:"px-8 py-5 text-center",children:"Tickets Served"}),(0,s.jsx)("th",{className:"px-8 py-5 text-right",children:"Sales Volume"}),(0,s.jsx)("th",{className:"px-8 py-5 text-right text-lime-700",children:"Commission Earned"})]})}),(0,s.jsxs)("tbody",{className:"divide-y divide-gray-50",children:[I.crewArray.map(t=>(0,s.jsxs)("tr",{className:"hover:bg-gray-50 transition-colors",children:[(0,s.jsx)("td",{className:"px-8 py-4 font-bold text-gray-800",children:t.name}),(0,s.jsx)("td",{className:"px-8 py-4 text-center text-gray-600",children:t.tickets}),(0,s.jsx)("td",{className:"px-8 py-4 text-right text-gray-600",children:e(t.sales)}),(0,s.jsx)("td",{className:"px-8 py-4 text-right font-bold text-lime-700 text-lg",children:e(t.commission)})]},t.name)),0===I.crewArray.length&&(0,s.jsx)("tr",{children:(0,s.jsx)("td",{colSpan:4,className:"px-8 py-10 text-center text-gray-400",children:"No active staff in this period"})})]})]}),"ITEMS"===r&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("thead",{className:"bg-gray-50 text-gray-500 font-bold text-xs uppercase tracking-wider border-b border-gray-100",children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{className:"px-8 py-5",children:"Item Name"}),(0,s.jsx)("th",{className:"px-8 py-5",children:"Type"}),(0,s.jsx)("th",{className:"px-8 py-5 text-center",children:"Qty Sold"}),(0,s.jsx)("th",{className:"px-8 py-5 text-right",children:"Revenue"}),(0,s.jsx)("th",{className:"px-8 py-5 text-right",children:"Cost (COGS + Labor)"}),(0,s.jsx)("th",{className:"px-8 py-5 text-right text-lime-700",children:"Net Profit"}),(0,s.jsx)("th",{className:"px-8 py-5 text-right",children:"Margin"})]})}),(0,s.jsxs)("tbody",{className:"divide-y divide-gray-50",children:[I.itemArray.map((t,r)=>{let a=t.revenue>0?t.profit/t.revenue*100:0;return(0,s.jsxs)("tr",{className:"hover:bg-gray-50 transition-colors",children:[(0,s.jsx)("td",{className:"px-8 py-4 font-bold text-gray-800",children:t.name}),(0,s.jsx)("td",{className:"px-8 py-4 text-xs font-bold uppercase text-gray-400",children:t.type}),(0,s.jsx)("td",{className:"px-8 py-4 text-center text-gray-600",children:t.qty}),(0,s.jsx)("td",{className:"px-8 py-4 text-right text-gray-600",children:e(t.revenue)}),(0,s.jsx)("td",{className:"px-8 py-4 text-right text-red-400",children:e(t.cost)}),(0,s.jsx)("td",{className:"px-8 py-4 text-right font-bold text-lime-700",children:e(t.profit)}),(0,s.jsxs)("td",{className:"px-8 py-4 text-right text-gray-500 text-xs font-bold",children:[a.toFixed(1),"%"]})]},r)}),0===I.itemArray.length&&(0,s.jsx)("tr",{children:(0,s.jsx)("td",{colSpan:7,className:"px-8 py-10 text-center text-gray-400",children:"No items sold in this period"})})]})]})]})})]})]})}function w(e){let{active:t,onClick:r,icon:a,label:l}=e;return(0,s.jsxs)("button",{onClick:r,className:"flex items-center gap-2 px-6 py-3 rounded-2xl font-bold text-sm transition-all duration-300 border\n                ".concat(t?"bg-gray-900 text-white border-gray-900 shadow-md":"bg-white text-gray-500 border-white hover:bg-gray-50 hover:text-gray-900"),children:[(0,s.jsx)(a,{className:"w-5 h-5 ".concat(t?"text-lime-400":"text-gray-400")}),l]})}},4067:(e,t,r)=>{Promise.resolve().then(r.bind(r,2716))},9749:(e,t,r)=>{"use strict";r.d(t,{t:()=>a});var s=r(2115);let a=()=>{let[e,t]=(0,s.useState)(null),[r,a]=(0,s.useState)(!0),[l,n]=(0,s.useState)(null),i="/api";return(0,s.useEffect)(()=>{(async()=>{if(!i)return a(!1);try{let a=await fetch("".concat(i,"/settings"));if(a.ok){var e,r,s,l,c,d,o;let n=await a.json();t({storeName:n.name||"",storeAddress:(null==(e=n.address)?void 0:e.street)||"",currency:n.currency||"PHP",taxRate:void 0!==n.tax_rate?Number(n.tax_rate):.08,enableNotifications:null==(o=null==(r=n.settings)?void 0:r.enableNotifications)||o,receiptHeader:(null==(s=n.receipt)?void 0:s.header)||"",receiptFooter:(null==(l=n.receipt)?void 0:l.footer)||"",printerName:(null==(c=n.receipt)?void 0:c.printerName)||"",theme:(null==(d=n.settings)?void 0:d.theme)||"light"})}else n("Failed to fetch settings")}catch(e){console.error(e),n("Error fetching settings")}finally{a(!1)}})()},[i]),{settings:e,loading:r,error:l,formatCurrency:t=>{let r=(null==e?void 0:e.currency)==="USD"?"$":(null==e?void 0:e.currency)==="EUR"?"€":"₱";return"".concat(r).concat(t.toFixed(2))},getCurrencySymbol:()=>e?"USD"===e.currency?"$":"EUR"===e.currency?"€":"₱":"₱"}}}},e=>{e.O(0,[4932,1684,8441,1255,7358],()=>e(e.s=4067)),_N_E=e.O()}]);