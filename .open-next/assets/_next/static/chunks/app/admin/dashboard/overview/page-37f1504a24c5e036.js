(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3361],{2507:(e,t,r)=>{"use strict";r.d(t,{A:()=>a});var s=r(5155);function a(e){let{title:t,description:r,className:a=""}=e;return(0,s.jsxs)("div",{className:"relative ".concat(a),children:[(0,s.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:t}),r&&(0,s.jsx)("p",{className:"text-base font-normal text-gray-700 mt-2 tracking-wide",children:r})]})}r(2115)},4413:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>w});var s=r(5155),a=r(2115),l=r(2507),i=r(707),o=r(1219),n=r(194),c=r(5350),d=r(3065),m=r(8968),x=r(2302),u=r(9749),h=r(1607),p=r(877);function f(e){let{data:t}=e,r={labels:t.map(e=>e.name),datasets:[{label:"Revenue",data:t.map(e=>e.revenue),fill:!0,backgroundColor:e=>{let t=e.chart.ctx.createLinearGradient(0,0,0,300);return t.addColorStop(0,"rgba(132, 204, 22, .9)"),t.addColorStop(1,"rgba(132, 204, 22, .1)"),t},borderColor:"#84cc16",borderWidth:3,tension:.4,pointBackgroundColor:"#84cc16",pointBorderColor:"#fff",pointBorderWidth:2,pointRadius:4,pointHoverRadius:6}]};return 0===t.length?(0,s.jsx)("div",{className:"flex items-center justify-center h-full text-gray-400 text-sm",children:"No data for selected period"}):(0,s.jsx)("div",{className:"w-full h-full",children:(0,s.jsx)(p.N1,{data:r,options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},tooltip:{backgroundColor:"rgba(0, 0, 0, 0.8)",padding:12,titleFont:{size:13},bodyFont:{size:13,weight:"bold"},cornerRadius:8,displayColors:!1,callbacks:{label:function(e){let t=e.dataset.label||"";return t&&(t+=": "),null!==e.parsed.y&&(t+=new Intl.NumberFormat("en-PH",{style:"currency",currency:"PHP"}).format(e.parsed.y)),t}}}},scales:{x:{offset:!0,grid:{display:!1},ticks:{color:"#000000",font:{size:11},maxRotation:0,autoSkip:!0,maxTicksLimit:7},border:{display:!1}},y:{grid:{color:"#f3f4f6",borderDash:[8,8],drawBorder:!1,drawTicks:!1},ticks:{color:"#000000",font:{size:11},padding:12,callback:function(e){return"₱"+e},maxTicksLimit:5},border:{display:!1},beginAtZero:!0}},interaction:{mode:"index",intersect:!1}}})})}h.t1.register(h.PP,h.kc,h.FN,h.No,h.hE,h.m_,h.s$,h.dN);var g=r(3366),y=r(6429),b=r(7717),v=r(661),N=r(6467),j=r(4932);function w(){let{formatCurrency:e}=(0,u.t)(),t="/api",[r,d]=(0,a.useState)([]),[m,x]=(0,a.useState)([]),[h,p]=(0,a.useState)([]),[w,S]=(0,a.useState)([]),[C,A]=(0,a.useState)([]),[E,P]=(0,a.useState)(!0),[T,_]=(0,a.useState)(!1),[R,z]=(0,a.useState)("week");(0,a.useEffect)(()=>{(async()=>{if(t){P(!0);try{let[e,r,s,a,l]=await Promise.all([fetch("".concat(t,"/tickets?all=true")),fetch("".concat(t,"/employees")),fetch("".concat(t,"/services")),fetch("".concat(t,"/products?all=true")),fetch("".concat(t,"/expenses"))]),i=e.ok?await e.json():[],o=r.ok?await r.json():[],n=s.ok?await s.json():[],c=a.ok?await a.json():[],m=l.ok?await l.json():[];d(Array.isArray(i)?i:[]),x(Array.isArray(o)?o:[]),p(Array.isArray(n)?n:[]),S(Array.isArray(c)?c:[]),A(Array.isArray(m)?m:[])}catch(e){console.error("Reports Fetch Error:",e)}finally{P(!1)}}})()},[t]),(0,a.useEffect)(()=>{_(!0)},[]);let M=(0,a.useMemo)(()=>{let e=new Date,t=(0,g.o)(e),s=(0,y.D)(e),a=null,l=null;"today"===R?(a={start:t,end:s},l={start:(0,b.e)(t,1),end:(0,b.e)(s,1)}):"week"===R?(a={start:(0,b.e)(e,7),end:s},l={start:(0,b.e)(e,14),end:(0,b.e)(s,7)}):"month"===R?(a={start:(0,b.e)(e,30),end:s},l={start:(0,b.e)(e,60),end:(0,b.e)(s,30)}):"year"===R&&(a={start:(0,b.e)(e,365),end:s},l={start:(0,b.e)(e,730),end:(0,b.e)(s,365)});let i=r.filter(e=>"COMPLETED"===e.status&&(!a||(0,v.v)((0,N.H)(e.createdAt),a))),o=0;l&&r.filter(e=>"COMPLETED"===e.status&&(0,v.v)((0,N.H)(e.createdAt),l)).forEach(e=>{let t=Number(e.total)||0;0===t&&e.items&&e.items.length>0&&(t=e.items.reduce((e,t)=>e+Number(t.unitPrice||0)*Number(t.quantity||0),0)),o+=t});let n=0,c=0,d=0,x={},u={},p={};m.forEach(e=>{x[e._id]={name:e.name,tickets:0,sales:0,commission:0}}),i.forEach(e=>{let t=Number(e.total)||0;0===t&&e.items&&e.items.length>0&&(t=e.items.reduce((e,t)=>e+Number(t.unitPrice||0)*Number(t.quantity||0),0)),n+=t;let r=(0,j.GP)((0,N.H)(e.createdAt),"yyyy-MM-dd");p[r]=(p[r]||0)+t;let s=Array.isArray(e.crew)?e.crew:[],a=s.length,l=a>0?t/a:0;s.forEach(e=>{let t="object"==typeof e&&e._id?e._id:"string"==typeof e?e:null;if(t){if(!x[t]){let r="object"==typeof e&&e.name?e.name:"Unknown Crew";x[t]={name:r,tickets:0,sales:0,commission:0}}x[t].tickets+=1,x[t].sales+=l}}),e.items.forEach(e=>{let t=Number(e.quantity)||0,r=Number(e.unitPrice)||0,l=Number(e.unitCost)||0,i=Number(e.commission)||0;if(0===l&&0===i){let t=h.find(t=>t._id===e.productId||t.name===e.productName||e.productName.startsWith(t.name));if(t){let r=Number(e.unitPrice)||0;i="percentage"===t.laborCostType?r*(Number(t.laborCost)||0)/100:Number(t.laborCost)||0}else{let t=w.find(t=>t._id===e.productId||t.name===e.productName);t&&(l=Number(t.cost)||0)}}let o=(l+i)*t;c+=o,d+=i*t;let n=e.productId||e.productName;if(!u[n]){let t=h.some(t=>t._id===e.productId)||i>0;u[n]={name:e.productName,qty:0,revenue:0,profit:0,type:t?"Service":"Product"}}if(u[n].qty+=t,u[n].revenue+=r*t,u[n].profit+=r*t-o,a>0&&i>0){let e=i*t/a;s.forEach(t=>{let r="object"==typeof t&&t._id?t._id:"string"==typeof t?t:null;r&&x[r]&&(x[r].commission+=e)})}})});let f=C.filter(e=>{let t=(0,N.H)(e.date);return!a||(0,v.v)(t,a)}).reduce((e,t)=>e+(Number(t.amount)||0),0),k=n-c,S=n-c-f,A=n>0?k/n*100:0,E=0;o>0?E=(n-o)/o*100:n>0&&(E=100);let P=new Set;i.forEach(e=>{let t=null;(t="object"==typeof e.customer&&e.customer?e.customer._id||e.customer.name:e.customer)&&P.add(t)});let T=Object.keys(p).sort().map(e=>({name:(0,j.GP)((0,N.H)(e),"MMM dd"),revenue:p[e]}));return{totalRevenue:n,revenueTrend:E,totalOrders:i.length,grossProfit:k,grossMargin:A,netProfit:S,totalLaborCost:d,totalExpenses:f,totalCustomers:P.size,crewStats:Object.values(x).filter(e=>e.tickets>0||e.sales>0),itemStats:Object.values(u).sort((e,t)=>t.revenue-e.revenue),chartData:T}},[r,m,h,w,C,R]);return(0,s.jsx)("div",{className:"relative min-h-screen w-full overflow-hidden text-gray-800",children:(0,s.jsxs)("div",{className:"relative z-10 space-y-8 animate-in fade-in duration-1000 lg:px-6 lg:pb-6",children:[(0,s.jsxs)("div",{className:"flex flex-col md:flex-row justify-between items-end gap-6 pb-2",children:[(0,s.jsx)(l.A,{title:"Overview",description:"Detailed breakdown of sales, profits, and expenses."}),(0,s.jsx)("div",{className:"bg-white p-1.5 rounded-2xl shadow-sm flex text-sm font-bold gap-1",children:["today","week","month","year","all"].map(e=>(0,s.jsx)("button",{onClick:()=>z(e),className:"px-6 py-2.5 rounded-xl transition-all duration-300 ".concat(R===e?"bg-blue-800 text-white shadow-md":"text-gray-600 hover:bg-gray-100"),children:e.charAt(0).toUpperCase()+e.slice(1)},e))})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[(0,s.jsx)(k,{title:"Net Revenue",value:e(M.totalRevenue),icon:i.A,desc:"all"===R?"total":"today"===R?"vs yesterday":"week"===R?"vs last week":"month"===R?"vs last month":"year"===R?"vs last year":"",trend:"all"!==R?M.revenueTrend:void 0,variant:"primary",helperText:"Total revenue from all completed orders within the selected period."}),(0,s.jsx)(k,{title:"Gross Profit",value:e(M.grossProfit),icon:o.A,desc:"".concat(M.grossMargin.toFixed(1),"% margin"),helperText:"Net Revenue minus total cost of items (COGS)."}),(0,s.jsx)(k,{title:"Total Commissions",value:e(M.totalLaborCost),icon:n.A,desc:"Crew payouts",helperText:"Accumulated commissions for services and products assigned to crew members."}),(0,s.jsx)(k,{title:"Total Orders",value:M.totalOrders.toString(),icon:c.A,desc:"".concat(M.totalCustomers," ").concat(1===M.totalCustomers?"Customer":"Customers"),helperText:"Total number of completed orders and the count of unique customers who placed them."})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[(0,s.jsx)("div",{className:"lg:col-span-2 bg-white p-8 rounded-3xl shadow-md relative overflow-hidden",children:(0,s.jsxs)("div",{className:"relative z-10",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-8",children:[(0,s.jsx)("h3",{className:"text-xl font-bold text-gray-900",children:"Revenue Trend"}),(0,s.jsxs)("div",{className:"flex items-center gap-2 text-sm text-gray-600 font-medium",children:[(0,s.jsx)("span",{className:"w-2 h-2 rounded-full bg-lime-500"}),(0,s.jsx)("span",{children:"Sales Volume"})]})]}),(0,s.jsx)("div",{className:"h-96 w-full",children:(0,s.jsx)(f,{data:M.chartData})})]})}),(0,s.jsx)("div",{className:"bg-white p-8 rounded-3xl shadow-md flex flex-col relative overflow-hidden",children:(0,s.jsxs)("div",{className:"relative z-10 flex flex-col h-full",children:[(0,s.jsx)("h3",{className:"text-xl font-bold text-gray-900 mb-8",children:"Top Performance"}),(0,s.jsxs)("div",{className:"flex-1 overflow-y-auto space-y-6 pr-2 custom-scrollbar",children:[M.itemStats.slice(0,6).map((t,r)=>{let a=t.revenue>0?t.profit/t.revenue*100:0;return(0,s.jsxs)("div",{className:"group",children:[(0,s.jsxs)("div",{className:"flex justify-between items-end mb-2",children:[(0,s.jsx)("p",{className:"font-bold text-gray-800 text-sm truncate",children:t.name}),(0,s.jsx)("p",{className:"font-bold text-gray-900 text-sm",children:e(t.revenue)})]}),(0,s.jsx)("div",{className:"relative h-1.5 bg-gray-100 rounded-full overflow-hidden border border-gray-200",children:(0,s.jsx)("div",{className:"absolute top-0 left-0 h-full bg-lime-500 rounded-full transition-all duration-1000",style:{width:"".concat(Math.max(5,Math.min(100,a)),"%")}})}),(0,s.jsxs)("div",{className:"flex justify-between mt-1 text-xs text-gray-500 font-medium",children:[(0,s.jsxs)("span",{children:[t.qty," units sold"]}),(0,s.jsxs)("span",{className:"text-lime-700 font-bold",children:[a.toFixed(0),"% margin"]})]})]},r)}),0===M.itemStats.length&&(0,s.jsx)("p",{className:"text-center text-gray-500 mt-10",children:"No visible performance data"})]})]})})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[(0,s.jsx)("div",{className:"bg-white rounded-3xl shadow-md overflow-hidden relative",children:(0,s.jsxs)("div",{className:"relative z-10",children:[(0,s.jsxs)("div",{className:"p-8 border-b border-gray-200 flex justify-between items-center bg-gray-50",children:[(0,s.jsx)("h3",{className:"text-xl font-bold text-gray-900",children:"Crew Performance"}),(0,s.jsx)("button",{className:"text-xs font-bold text-lime-700 uppercase tracking-widest hover:text-lime-800 hover:underline decoration-2 underline-offset-4",children:"View All"})]}),(0,s.jsx)("div",{className:"overflow-x-auto",children:(0,s.jsxs)("table",{className:"w-full text-left text-sm",children:[(0,s.jsx)("thead",{className:"text-gray-500 font-bold text-xs uppercase tracking-wider border-b border-gray-200",children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{className:"px-8 py-6",children:"Member"}),(0,s.jsx)("th",{className:"px-8 py-6 text-center",children:"Tickets"}),(0,s.jsx)("th",{className:"px-8 py-6 text-right",children:"Sales"}),(0,s.jsx)("th",{className:"px-8 py-6 text-right text-lime-700",children:"Comm."})]})}),(0,s.jsxs)("tbody",{className:"divide-y divide-gray-200",children:[M.crewStats.map((t,r)=>(0,s.jsxs)("tr",{className:"hover:bg-gray-50 transition-colors group",children:[(0,s.jsx)("td",{className:"px-8 py-5 font-bold text-gray-800",children:t.name}),(0,s.jsx)("td",{className:"px-8 py-5 text-center text-gray-600 font-medium",children:t.tickets}),(0,s.jsx)("td",{className:"px-8 py-5 text-right text-gray-600 font-medium",children:e(t.sales)}),(0,s.jsx)("td",{className:"px-8 py-5 text-right font-bold text-gray-900 group-hover:text-lime-700 transition-colors",children:e(t.commission)})]},r)),0===M.crewStats.length&&(0,s.jsx)("tr",{children:(0,s.jsx)("td",{colSpan:4,className:"px-8 py-10 text-center text-gray-500",children:"No active crew"})})]})]})})]})}),(0,s.jsx)("div",{className:"bg-white rounded-3xl shadow-md overflow-hidden relative",children:(0,s.jsxs)("div",{className:"relative z-10",children:[(0,s.jsxs)("div",{className:"p-8 border-b border-gray-200 flex justify-between items-center bg-gray-50",children:[(0,s.jsx)("h3",{className:"text-xl font-bold text-gray-900",children:"Breakdown"}),(0,s.jsx)("button",{className:"text-xs font-bold text-lime-700 uppercase tracking-widest hover:text-lime-800 hover:underline decoration-2 underline-offset-4",children:"Export"})]}),(0,s.jsx)("div",{className:"overflow-x-auto",children:(0,s.jsxs)("table",{className:"w-full text-left text-sm",children:[(0,s.jsx)("thead",{className:"text-gray-500 font-bold text-xs uppercase tracking-wider border-b border-gray-200",children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{className:"px-8 py-6",children:"Item"}),(0,s.jsx)("th",{className:"px-8 py-6 text-center",children:"Qty"}),(0,s.jsx)("th",{className:"px-8 py-6 text-right",children:"Rev"}),(0,s.jsx)("th",{className:"px-8 py-6 text-right",children:"Profit"})]})}),(0,s.jsxs)("tbody",{className:"divide-y divide-gray-200",children:[M.itemStats.slice(0,8).map((t,r)=>(0,s.jsxs)("tr",{className:"hover:bg-gray-50 transition-colors",children:[(0,s.jsxs)("td",{className:"px-8 py-5 font-bold text-gray-800",children:[t.name,(0,s.jsx)("span",{className:"block text-[10px] text-gray-500 font-bold uppercase tracking-widest mt-0.5",children:t.type})]}),(0,s.jsx)("td",{className:"px-8 py-5 text-center text-gray-600 font-medium",children:t.qty}),(0,s.jsx)("td",{className:"px-8 py-5 text-right text-gray-600 font-medium",children:e(t.revenue)}),(0,s.jsx)("td",{className:"px-8 py-5 text-right font-bold text-lime-700",children:e(t.profit)})]},r)),0===M.itemStats.length&&(0,s.jsx)("tr",{children:(0,s.jsx)("td",{colSpan:4,className:"px-8 py-10 text-center text-gray-500",children:"No data available"})})]})]})})]})})]})]})})}function k(e){let{title:t,value:r,icon:a,desc:l,variant:i="default",trend:o,helperText:n}=e,c="primary"===i,u=c?"bg-gradient-to-br from-lime-500 to-green-600 text-white border border-lime-500 shadow-sm hover:shadow-lg hover:-translate-y-1 hover:scale-[1.02]":"bg-neutral-50 border-2 border-white shadow-sm hover:shadow-lg hover:-translate-y-1 hover:scale-[1.02] text-gray-900",h=c?"bg-white/20 text-white border-white/10":"bg-gray-50 text-gray-500 border-gray-100 group-hover:text-lime-600",p=c?"text-lime-100":"text-gray-500",f=c?"text-white drop-shadow-sm":"text-gray-900",g=c?"text-lime-100":"text-gray-500",y=void 0!==o?o>=0?d.A:m.A:null,b=void 0!==o?o>=0?c?"text-white":"text-lime-600":c?"text-white":"text-red-500":"";return(0,s.jsxs)("div",{className:"p-4 rounded-3xl transition-all duration-300 group relative overflow-visible ".concat(u),children:[c&&(0,s.jsx)("div",{className:"absolute top-0 right-0 p-32 bg-white/10 rounded-full -mr-16 -mt-16 blur-2xl pointer-events-none"}),n&&(0,s.jsxs)("div",{className:"absolute top-4 right-4 z-20 flex flex-col items-end group/tooltip",children:[(0,s.jsx)(x.A,{className:"w-5 h-5 transition-colors duration-300 cursor-help ".concat(c?"text-lime-200 group-hover/tooltip:text-white":"text-gray-300 group-hover/tooltip:text-gray-500")}),(0,s.jsx)("div",{className:"absolute top-6 right-0 w-48 opacity-0 group-hover/tooltip:opacity-100 transition-all duration-300 ease-in-out delay-500 translate-y-2 group-hover/tooltip:translate-y-0 pointer-events-none z-50",children:(0,s.jsxs)("div",{className:"bg-gray-900/90 backdrop-blur-sm text-white text-xs p-3 rounded-xl shadow-xl border border-white/10 leading-relaxed mt-2 relative",children:[(0,s.jsx)("div",{className:"absolute -top-1 right-1 w-2 h-2 bg-gray-900/90 rotate-45 border-l border-t border-white/10"}),n]})})]}),y&&(0,s.jsx)("div",{className:"absolute -top-16 -right-3 pointer-events-none opacity-15 group-hover:scale-110 transition-all duration-500 ease-in-out ".concat(c?"text-white":o>=0?"text-lime-500":"text-red-500"),children:(0,s.jsx)(y,{className:"w-72 h-72"})}),(0,s.jsxs)("div",{className:"relative z-10 flex flex-col h-full justify-between",children:[(0,s.jsx)("div",{children:(0,s.jsxs)("div",{className:"flex items-center gap-4 mb-4",children:[(0,s.jsx)("div",{className:"p-3 rounded-2xl shadow-sm border transition-colors duration-300 ".concat(h),children:(0,s.jsx)(a,{className:"w-6 h-6"})}),(0,s.jsx)("p",{className:"text-xs font-bold uppercase tracking-wider ".concat(p),children:t})]})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-3xl font-bold tracking-tight ".concat(f),children:r}),(0,s.jsxs)("div",{className:"flex items-center gap-2 mt-2",children:[void 0!==o&&(0,s.jsx)("div",{className:"flex items-center gap-1 text-sm font-bold ".concat(b),children:(0,s.jsxs)("span",{children:[Math.abs(o).toFixed(0),"%"]})}),(0,s.jsx)("p",{className:"text-sm font-medium tracking-wide ".concat(g),children:l})]})]})]})]})}},8125:(e,t,r)=>{Promise.resolve().then(r.bind(r,4413))},9749:(e,t,r)=>{"use strict";r.d(t,{t:()=>a});var s=r(2115);let a=()=>{let[e,t]=(0,s.useState)(null),[r,a]=(0,s.useState)(!0),[l,i]=(0,s.useState)(null),o="/api";return(0,s.useEffect)(()=>{(async()=>{if(!o)return a(!1);try{let a=await fetch("".concat(o,"/settings"));if(a.ok){var e,r,s,l,n,c,d;let i=await a.json();t({storeName:i.name||"",storeAddress:(null==(e=i.address)?void 0:e.street)||"",currency:i.currency||"PHP",taxRate:void 0!==i.tax_rate?Number(i.tax_rate):.08,enableNotifications:null==(d=null==(r=i.settings)?void 0:r.enableNotifications)||d,receiptHeader:(null==(s=i.receipt)?void 0:s.header)||"",receiptFooter:(null==(l=i.receipt)?void 0:l.footer)||"",printerName:(null==(n=i.receipt)?void 0:n.printerName)||"",theme:(null==(c=i.settings)?void 0:c.theme)||"light"})}else i("Failed to fetch settings")}catch(e){console.error(e),i("Error fetching settings")}finally{a(!1)}})()},[o]),{settings:e,loading:r,error:l,formatCurrency:t=>{let r=(null==e?void 0:e.currency)==="USD"?"$":(null==e?void 0:e.currency)==="EUR"?"€":"₱";return"".concat(r).concat(t.toFixed(2))},getCurrencySymbol:()=>e?"USD"===e.currency?"$":"EUR"===e.currency?"€":"₱":"₱"}}}},e=>{e.O(0,[5647,4932,9039,8441,1255,7358],()=>e(e.s=8125)),_N_E=e.O()}]);